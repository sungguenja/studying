# 브라우저 관련 정리

1. 브라우저의 렌더링 원리
   1. HTML 파싱 및 DOM 트리 생성
      1. 과정: 브라우저는 HTML 파일을 위에서 아래로 읽으며 각 태그를 해석하여 DOM트리를 생성
      2. `<html>` 태그에서 시작해 `<head>`, `<body>`를 읽고, 각각의 자식 태그들을 DOM 노드로 추가합니다
      3. HTML 태그의 잘못된 문법이 있다면 이를 교정하는 작업도 수행합니다
      4. 그 결과 DOM 트리는 문서의 구조와 콘텐츠를 계층적으로 나타냅니다
   2. CSS 파싱 및 CSSOM 트리 생성
      1. 브라우저는 HTML에서 `<style>` 태그 또는 외부 CSS 파일을 만나면 이를 파싱하여 CSSOM 트리를 생성합니다
      2. CSSOM은 스트일 규칙을 DOM 요소에 매핑합니다
      3. CSS 파싱이 완료된 후 브라우저는 CSSOM을 DOM 트리와 결합합니다.
      4. 그 결과 DOM과 CSSOM이 결합되어 **랜더 트리**가 생성됩니다
   3. JavaScript 파싱 및 실행
      1. HTML 파싱 중 `<script>` 태그를 만나면 브라우저는 해당 스크립트를 다운로드하고 실행합니다
      2. JavaScript가 DOM이나 CSSOM에 접근하여 변경을 가할 수 있으므로, 실행이 완료될 때까지 HTML 파싱이 일시적으로 멈춥니다
         1. 단, async나 defer 속성을 사용하면 비동기로 처리 가능
      3. 그 결과 JavaScript는 DOM 트리나 CSSOM 트리를 변경하거나 사용자 상호작용을 처리하는 동작을 추가합니다
   4. 렌더 트리 생성
      1. DOM 트리와 CSSOM 트리를 결합하여 렌더 트리가 생성됩니다. 렌더 트리는 화ㅗ면에 표시될 요소만 포함하며, 각 요소의 스타일 및 레이어아수 정보를 포함합니다.
   5. 레이아웃
      1. 렌더 트리를 기반으로 각 요소의 크기와 위치를 계산합니다.
      2. 이를 레이아웃 단계라고 하며, 뷰포트 크기와 상대적인 위치를 기반으로 배치됩니다
   6. 페인팅
      1. 브라우저는 렌더 트리를 기반으로 각 요소를 화면에 픽셀로 그립니다.
      2. 색상, 텍스처, 그림자 등 시각적인 요소가 적용됩니다
   7. 컴포지팅
      1. 페인팅된 요소를 GPU를 사용하여 합성합니다
      2. 이 단계에서는 레이어를 병합하여 최종적으로 사용자 화면에 출력합니다
   8. 결론 (전체 흐름)
      ```
      HTML => DOM 트리
      CSS => CSSOM 트리
      DOM + CSSOM => 렌더 트리 => 레이아웃 => 페인팅 => 컴포지팅
      ```
2. reflow와 repaint
   1. reflow
      - reflow는 브라우저가 요소의 **레이아웃(크기와 위치)**을 다시 계산하는 과정
      - DOM이나 CSSOM이 변경되어 요소의 배치가 영향을 받을 때 발생
      - 발생 시점
        - 레이아웃 관련 변경이 있을 때
          - DOM 구조 변경
          - CSS 속성 변경
          - 브라우저 창 크기 변경
          - 폰트 크기 변경
          - 스크롤 위치 변경
        - JS에서 레이아웃 정보를 요청할 때
          - offsetWidth, offsetHeight, getBoundingClientRect같은 메서드 호출
      - 영향 범위
        - reflow는 전체 페이지 또는 일부 DOM 요소에 영향을 미칠 수 있습니다
        - 영향을 받는 요소와 그 자식 요소, 형제 요소까지 레이아웃을 재계산합니다
   2. repaint
      - repaint는 브라우저가 요소의 시각적스타일을 다시 그리는 과정입니다
      - 요소의 배치는 변경되지 않고, 생상, 배경, 그림자, 테두리 등과 같은 스타일만 변경됩니다
      - 발생 시점
        - 시각적 속성 변경
          - CSS 속성 변경
        - DOM 상태 변경으로 화면이 다시 그려질 필요가 있을 때
          - 요소의 시각적 속성이 JS로 조작될 때
          - CSS 애니메이션 실행 중
      - 영향 범위
        - reapint는 reflow보다 상대적으로 영향을 미치는 범위가 좁다
        - 요소의 스타일만 다시 그리므로 레이아웃 계산은 수행되지 않습니다
   3. 둘의 차이
      - | 구분      | reflow                       | repaint                                |
        | --------- | ---------------------------- | -------------------------------------- |
        | 정의      | 레이아웃 계산 및 배치 재조정 | 스타일 변경으로 화면 재그리기          |
        | 발생 원인 | 요소 크기/위치 변경          | 색상, 배경, 그림자 등 시각적 속성 변경 |
        | 성능 영향 | 더 많은 리소스 소모          | 비교적 적은 리소스 소모                |
        | 영향 범위 | 관련 DOM 트리 전체           | 특정 요소만                            |
   4. 최적화 팁
      1. DOM 조작을 최소화하고, 필요한 변경 사항을 한 번에 처리합니다.
      2. 레이아웃 정보를 읽고 조작하는 작업을 분리합니다
      3. visibility: hidden 을 사용하여 reflow를 피하고, 필요할 때 display: none으로 변경
      4. css 애니메이션을 gpu에서 실행 가능한 속성으로 제한합니다
3. css
   - margin, padding
