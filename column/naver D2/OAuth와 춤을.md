# OAuth와 춤을

> 1. OAuth의 탄생과 사용
> 2. OAuth와 로그인
> 3. OpenID와 OAuth
> 4. OAuth Dance, OAuth 1.0 인증과정
> 5. Request Token
> 6. oauth_signature 만들기
> 7. 사용자 인증 페이지의 호출
> 8. Access Token 요청하기
> 9. Access Token 사용하기
> 10. OAuth 2.0
> 11. OAuth로 인한 인터넷 서비스의 변화

[글 링크](https://d2.naver.com/helloworld/24942)

현재 OAuth에 대한 개념을 조금 잘못 잡고 있는 듯 하여 한번 정리해볼까 한다. 이 글과 함께 다른 글도 같이 정리를 해서 한번에 정리해볼 예정이다. 그리고 NHN cloud 쪽에서 OAuth2.0도 다뤄보자

----

최근 인터넷 서비스는 SaaS (Software as a Service)의 형태이다. 유저들은 별도의 인증 거치지 않고 Facebook이나 트위터의 기능을 이용하여 인증을 받고 해당 서비스를 이용할 수 있게 되었다. 이 방식에서 사용하는 인증절차가 **OAuth**이다. 해당 칼럼은 OAuth의 탄생 배경과 OAuth 1.0의 인증 과정에 대해 간략하게 설명 해준다.

## 1. OAuth의 탄생과 사용

OAuth는 인증을 위한 오픈 스탠더드 프로토콜이다. 사용자가 특정 서비스를 이용해 다른 서비스를 이용할 수 있도록 도와준다. OAuth이전에도 다른 애플리케이션에 사용자의 아이디와 암호가 노출되지 않도록 하면서 API접근 위임이 가능한 여러 인증방법이 있긴 했다.

1.0은 07년도에 나왔으며 수정버전은 08년도에 등장했다. 12년도 기준으로 2.0이 드래프트 단계에 있고 해당 방식을 이용하는 서비스도 많다. 1.0과 2.0은 호환되지 않고 약간 다른 방식이다.

## 2. OAuth와 로그인

일반적 로그인과 OAuth를 비교해보자. 회사를 비유하여 다음과 같은 절차를 생각해보자

- 나방문씨(외부 손님)가 안내 데스크에서 업무적인 목적으로 김목적씨(회사 사원)을 만나러 왔다고 말한다.
- 안내 데스크에서는 김목적씨에게 나방문씨가 방문했다고 연락한다.
- 김목적씨가 안내 데스크로 찾아와 나방문씨의 신원을 확인해 준다.
- 김목적씨는 업무 목적과 인적 사항을 안내 데스크에서 기록한다.
- 안내 데스크에서 나방문 씨에게 방문증을 발금해 준다.
- 김목적씨와 나방문씨는 정해진 장소로 이동해 업무를 진행한다.

OAuth의 개념에서 보자. 인증 가능한 업체(김목적)가 인증을 해주고 서비스(안내 데스크)는 방문증(인증 토큰)을 발급해주는 방식이다. 

## 3. OpenID와 OAuth

OpenID도 인증을 위한 표준 프로토콜이며 HTTP를 사용하는 점에서 OAuth와 같다. 그러나 둘의 목적은 다르다

OpenID의 주요 목적은 인증이지만 OAuth는 허가이다. 즉, `OpenID를 사용한다 == 로그인`

OAuth에도 인증은 있다. 하지만 근본 목적은 API를 호출할 수 있는 권한이나, 친구 목록을 가져오는 API를 호출할 수 있는 권한이 있는 사용자인지 확인하는 것이다. OAuth도 인증을 위해 쓸 수는 있지만 근본은 다르다

## 4. OAuth Dance, OAuth 1.0 인증과정

OAuth의 인증과정을 OAuth Dance라고 한다. 일단 알아보기 전에 햇갈리지 않기 위해 용어를 정리하고 가자

| 용어             | 설명                                                         |
| ---------------- | ------------------------------------------------------------ |
| User             | Service Provider에 계정을 가지고 있으면서, Consumer를 이요하려는 사용자 |
| Service Provider | OAuth를 사용하는 OpenAPI를 제공하는 서비스                   |
| Consumer         | OAuth인증을 사용해 Service Provider의 기능을 사용하려는 애플리케이션이나 웹 서비스 |
| Request Token    | Consumer가 Service Provider에게 접근 권한을 인증받기 위해 사용하는 값, 인증이 완료된 후에는 Access Token으로 교환한다. |
| Access Token     | 인증 후 Consumer가 Service Provider의 자원에 접근하기 위한 키를 포한한 값 |

![](OAuth.png)

아까 회사 방문과 한번 비교해보자

| 회사 방문 과정                                               | OAuth 인증 과정                        |
| ------------------------------------------------------------ | -------------------------------------- |
| 나방문씨가 안내 데스크에서 업무적인 목적으로 김목적씨를 만나러 왔다고 말한다. | Request Token의 요청과 발급            |
| 안내 데스크에서는 김목적씨에게 나방문씨가 방문했다고 연락한다. | 사용자 인증 페이지 호출                |
| 김목적씨가 안내 데스크로 찾아와 나방문씨의 신원을 확인해 준다. | 사용자 로그인 완료                     |
| 김목적씨는 업무 목적과 인적 사항을 안내 데스크에서 기록한다  | 사용자의 권한 요청 및 수락             |
| 안내 데스크에서 나방문 씨에게 방문증을 발급해 준다           | Access Token발급                       |
| 김목적씨와 나방문씨는 정해진 장소로 이동해 업무를 진행한다.  | Access Token을 이용해 서비스 정보 요청 |

간편하게 이해가 될 것이다.

## 5. Request Token

request token 발급 요청은 각 서비스마다 다를 것이다. 그 해당 서비스의 OAuth의 문서를 잘 읽어보는 것이 좋다

## 6. oauth_signature 만들기

Consumer와 Service Provider가 같은 암호화 알고리즘을 이용하여 oauth_signature를 만들어야 한다. 그리고 그것은 아래 네 단계를 거치는것이 일반적이다

1. 요청 매개변수를 모두 모은다
2. 매개변수를 정규화한다
3. Signature Base String을 만든다
4. 키 생성

## 7. 사용자 인증 페이지의 호출

각 서비스마다 제공하는 인증 페이지를 열어야 한다. 

## 8. Access Token 요청하기

OAuth에서의 AccessToken은 나방문 씨에게 지급할 방문증과 같다. Access Token을 요청하는 방법은 Request Token을 요청하는 방법과 같다. 다만, 사용하는 매개변수의 종류가 약간 다르고 oauth_signature를 생성할 때 사용하는 키가 다르다. 

Request Token 발급을 요청할 때에는 Consumer Secret Key를 사용해 필요한 것을 생성하고 Access Token 발급을 요청할 때에는 Consumer Secret Key를 이용해 암호화를 더욱 더 시켜 보안을 강화한다

## 9. Access Token 사용하기

사용도 해당 서비스에 맞춰서 적절히 조절하면 된다

## 10. OAuth 2.0

12년도 기준으로는 아직 최종안이 나오지 않았다. 특징은 아래와 같다

- 웹 애플리케이션이 아닌 애플리케이션 지원 강화
- 암호화가 필요 없음 HTTPS를 사용하고 HMAC을 사용하지 않는다.
- Signature 단순화 정렬과 URL 인코딩이 필요 없다
- Access Token 갱신 OAuth 1.0에서 Access Token을 받으면 Access Token을 계속 사용할 수 있었다. 트위터의 경우에는 Access Token을 만료시키지 않는다. OAuth 2.0에서는 보안 강화를 위해 Access Token의 라이프 타임을 지정할 수 있도록 했다

## 11. OAuth로 인한 인터넷 서비스의 변화

요즘의 인터넷 생태계의 주요 요소로 자리매김하고 있다. 신생 업체는 고유의 인증방식을 사용하지 않고 OAuth를 이용하고 있다. 새로운 인증 방법 하나가 인터넷 업계에 변화를 주고 있다.