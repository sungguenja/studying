# 1부 HTTP: 웹의 기초

## 2장 URL과 리소스

- 이 장에서 다룰 것들
  - URL 문법, 여러 URL 컴포넌트가 어떤 의미를 가지며 무엇을 수행하는지
  - 여러 웹 클라이언트가 지원하는 상대 URL과 확장 URL 같은 단축 URL에 대해서
  - URL의 인코딩과 문자 규칙
  - 여러 인터넷 정보 시스템에 적용되는 공통 URL 스킴
  - 기존 이름은 유지하면서 객체들을 다른 장소로 옮기는 것을 가능하게 해주는 URN을 포함한 URL의 미래

### 2.1 인터넷의 리소스 탐색하기

URI는 URL과 URN으로 구성된 종합개념이다. 하지만 URI을 URL이라고 또는 반대로 하기도 한다. 왜냐하면 아직 URN이 그렇게 성장하지 못해 인지도가 떨어지기 때문이다. URL을 한번 뜯어서 살펴보자

- URL의 첫 부분인 `http(일반적으로는)` 부분은 URL의 스킴이다. 스킴은 웹 크라라이언트가 리소스에 어떻게 접근하는지 알려준다. 이 경우에, URL이 HTTP 프로토콜을 사용한다
- URL의 두번째 부분인 `www.~.com`은 서버의 위치다. 이는 웹 클라이언트가 리소스가 어디에 호스팅 되어있는지 알려준다.
- URL의 세 번째 부분인 `/~`은 리소스의 경로다. 경로는 서버에 존재하는 로컬 리소스들 중에서 요청받은 리소스가 무엇인지 알려준다.

#### 2.1.1 URL이 있기 전 암흑시대

> 별 다른 건 없고 정말 혼돈의 시대였던 것 같다.
>
> 굳이 요약은 안해도 될 듯 하다

### 2.2 URL 문법

URL 스킴의 문법은 일반적으로 9개 부분으로 나뉜다.

```text
<스킴>://<사용자 이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>
```

| 컴포넌트    | 설명                                                                                                                                                                                                                                                                      | 기본값           |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------- |
| 스킴        | 리소스를 가져오려면 어떤 프로토콜을 사용하여 서버에 접근해야 하는지 가리킨다.                                                                                                                                                                                             | 없음             |
| 사용자 이름 | 몇몇 스킴은 리소스에 접근을 하기 위해 사용자 이름을 필요로 한다.                                                                                                                                                                                                          | anonymous        |
| 비밀번호    | 사용자의 비밀번호를 가리키며, 사용자 이름에 콜론(`:`)으로 이어서 기술한다.                                                                                                                                                                                                | <이메일 주소>    |
| 호스트      | 리소스를 호스팅하는 서버의 호스트 명이나 IP 주소.                                                                                                                                                                                                                         | 없음             |
| 포트        | 리소스를 호스팅하는 서버가 열어놓은 포트번호. 많은 스킴이 기본 포트를 가지고 있다(HTTP의 기본 포트는 80이다)                                                                                                                                                              | 스킴에 따라 다름 |
| 경로        | 이전 컴포넌트와 빗금(`/`)으로 구분되어 있으며, 서버 내 리소스가 서버 어디에 있는지를 가리킨다. 경로 컴포넌트의 문법은 서버와 스킴에 따라 다르다. (이 장 뒤에서는 URL의 경로를 세그먼트로 나눌 수 있고, 각 세그먼트는 자체 컴포넌트를 가질 수 있다는 것을 알게 될 것이다.) | 없음             |
| 파라미터    | 특정 스킴들에서 입력 파라미터를 기술하는 용도로 사용한다. 파라미터는 이름/값을 쌍으로 가진다. 파라미터는, 다른 파라미터나 경로의 일부와 세미콜론(`:`)으로 구분하여 기술하며, 여러 개를 가질 수 있다.                                                                      | 없음             |
| 질의        | 스킴에서 애플리케이션에 파라미터를 전달하는데 쓰인다. 질의 컴포넌트를 작성하는데 쓰이는 공통 포맷은 없다. 이는 URL의 끝에 `?`로 구분한다                                                                                                                                  | 없음             |
| 프래그먼트  | 리소스의 조각이나 일부분을 가리키는 이름이다. URL이 특정 객체를 가리킬 경우에 프래그먼트 필드는 서버에 전달되지 않는다. 이는 클라이언트에서만 사용한다. URL의 끝에서 `#`문자로 구분한다.                                                                                  | 없음             |

- 스킴
  - 사용할 프로토콜
  - 스킴은 주어진 리소스에 어떻게 접근하는지 알려주는 중요한 정보
  - 어떤 프로토콜을 사용하여 리소스를 요청해야 하는지 알려준다
  - url의 스킴은 `http`이다.
  - 스킴은 대소문자를 가리지 않는다
- 호스트와 포트
  - `리소스를 호스팅 하고 있는 장비 + 장비 내 리소스에 접근할 수 있는 서버 위치`를 알려줌
  - 호스트 컴포넌트는 접근하려고 하는 리소스를 가지고 있는 인터넷상의 호스트 장비
  - 호스트 명이나 ip주소로 제공
  - 포트 컴포넌트는 서버가 열어놓은 네트워크 포트를 의미
- 사용자 이름과 비밀번호
  - FTP 서버가 좋은 예이다
    ```
    ftp://ftp.prep.ai.mit.edu/pub/gnu
    ftp://anonymous@ftp.prep.ai.mit.edu/pub/gnu
    ftp://anonymous:my_passwd@ftp.prep.ai.mit.edu/pub/gnu
    ```
    - 첫 번째 예는 사용자 이름이나 비밀번호 컴포넌트가 없이 표준 스킴, 호스트, 경로만 있다
      - 애플리케이션이 FTP와 같이 사용자 이름과 비밀번호를 요구하는 URL 스킴을 사용한다면,
      - 그 값들이 삽입되어 있지 않으 ㄹ경우 기본 사용자 이름과 비밀번호 값을 넣어놓을 것이다
    - 두 번째 예는 사용자 이름이 `anonymous`로 되어있다.
      - 호스트 컴포넌트와 나란히 기술되어 있는 사용자 이름은 단순한 이메일 주소처럼 보이기도 한다
    - 세 번째 예는 사용자 이름과 비밀번호를 `:`문자로 분리하여 모두 기술하였다
- 경로
  - URL의 경로 컴포넌트는 리소스가 서버의 어디에 있는지 알려준다
- 파라미터
  - 많은 스킴이 객체에 대한 호스트 및 경로 정보만으로는 리소스를 찾지 못한다.
  - 서버가 어떤 포트를 열어놓고 있는지, 리소스에 접근하기 위해 사용자 이름과 비밀번호를 명시했는지 여부 외에도 많은 프로토콜이 더 많은 정보를 요구한다.
- 질의 문자열
  - 데이터베이스 같은 서비스들은 요청받을 리소스 형식의 범위를 좁히기 위해서 질문이나 질의를 받을 수 있다.
    ```
    http://www.joes-hardware.com/inventory-check.chi?item=12731
    ```
  - `?`의 우측에 있는 값들이 `질의 컴포넌트`이다.
- 프래그먼트
  - 리소스의 특정 부분을 가리킬 수 있도록, URL은 리소스 내의 조각을 가리킬 수 있는 프래그먼트 컴포넌트를 제공한다.
  - 프래그먼트는 URL의 오른쪽에 `#` 문자에 이어서 나온다.

### 2.3 단축 URL

- 상대 URL
  - 지금까지 봐온 것은 절대 URL이다.
  - 상대 URL은 모든 정보를 담고 있지는 않다. 리소스에 접근하는데 필요한 모든 정보를 얻기 위해서는, 기저(base)라고 하는 다른 URL을 사용해야 한다
  - 상대 URL이 포함된 HTML 코드를 살펴보자
    ```HTML
    <HTML>
      <HEAD><TITLE>Joe's Tools</TITLE></HEAD>
      <BODY>
        <H1> Tools Page </H1>
        <H2> Hammers </H2>
        <P> Joe's Hardware Online has the largest selection of <A HREF='./hammers.html'>hammers</A>on earth</P>
      </BODY>
    </HTML>
    ```
  - 기저 URL이 아래와 같다고 해봅시다
    ```
    http://www.joes-hardware.com/tools.html
    ```
  - 그러면 우리는 A태그를 눌렀을 경우 상대 위치로 아래 리소스를 찾게 될 것이다
    ```
    http://www.joes-hardware.com/hammers.html
    ```
  - 기저 URL
    - 변환 과정의 첫 단계는 기저 URL을 찾는 것이다.
    - 기저 URL은 상대 URL의 기준이 된다
    - 가져오는 방식을 살펴보자
      - 리소스에서 명시적으로 제공
        - 어떤 리소스들은 기저 URL을 명확하게 기술하기도 한다
        - 모든 상대 URL을 변경하기 위해서 기저 URL을 가리키는 `<BASE>` HTML 태그를 기술할 수 있다
      - 리소스를 포함하고 있는 기저 URL
        - 만약 상대 URL이 명시되지 않은 리소스에 포함된 경우
        - 위 예시처럼 이용한다
      - 기저 URL이 없는 경우
        - 기저 URL이 없는 경우도 있다.
        - 절대 URL로 이루어진 케이스이다
  - 상대 참조 해석하기
    - 상대 URL을 절대 URL을 바꾸는 알고리즘은 글로 정리하면 다음과 같다 ~~(그림은 책보셈)~~ ~~(chatGPT형님이 잘정리해줌)~~
      1. 만약 상대 url이 `/`로 시작할 경우
         - 이것은 절대 url입니다.
         - 절대 url을 얻으려면 현재 페이지의 원점을 상대 url에 추가합니다
      2. 상대 url이 `http:// https://`로 시작할 경우
         - 이미 절대 url인데요?
      3. `.`으로 시작할 경우
         - 상대 url입니다
         - 페이지의 현재 url을 구문 분석합니다
         - 기저 url을 구한 다음 상대 url을 기저 url에 더합니다
      4. 위 세가지 경우가 아닌 상황
         - 현재 url을 분석하여 기저 url을 구합니다.
         - 마지막 `/` 이후로 전부 제거합니다
         - 상대 url을 기저 url에 추가합니다
- URL 확장
  - 어떤 브라우저들은 URL을 입력한 다음이나 입력하고 있는 동안에 자동으로 URL을 확장한다
  - 확장 기능은 두가지로 나뉜다
    - 호스트 명 확장
      - 단순한 휴리스틱만 사용해서 입력한 호스트명을 전체 호스트 명으로 확장할 수 있다.
      - 예를 들어) `yahoo`를 입력하면 `www.`과 `.com`을 자동으로 붙여서 전체 url을 만드는 것입니다
    - 히스토리 확장
      - 브라우저가 url 기록을 보고 자동으로 연결해주는 것입니다

### 2.4 안전하지 않은 문자

> URL은 잘 호환되도록 설계되었다. 어떤 인터넷 프로토콜을 통해서든 안전하게 전송될 수 있또록 URL을 설계하는 것은 중요했다.
>
> 안전한 전송? `정보 유실의 위험 == 0`
>
> URL 설계자들은, 모든 인터넷 프로토콜로 URL이 전송될 수 있기를 바랐고, 이와 함께 가독성도 있기를 바랐다.

- URL 문자 집합
  - 많은 컴퓨터 애플리케이션이 `US-ASCII` 문자 집합을 사용해왔다. 하지만 오래된 문자집합이며, 적은 수의 문자만을 포함하고 있다. 전세계를 커버하기엔 어렵다.
  - 그뿐만 아니라 URL이 특정 이진 데이터를 포함해야하는 경우도 있다. 이스케이프 문자열을 쓸 수 있게 설계할 필요가 있었습니다.
- 인코딩 체계
  - 안전한 문자 집합을 이용하는 경우 그 표현의 한계를 넘기 위해, URL에 있는 안전하지 않은 문자들을 표현할 수 있는 인코딩 ㅂ아식이 고안되었다.
- 문자 제한
  - 몇몇 문자는 URL 내에서 특별한 의미로 예약되어 있다.
  - | 문자                                    | 선점 및 제한                                                                                                             |
    | --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
    | %                                       | 인코딩된 문자에 사용할 이스케이프 토큰으로 선점                                                                          |
    | /                                       | 경로 컴포넌트에 있는 경로 세그먼트를 나누느 용도로 선점                                                                  |
    | `.`, `..`                               | 경로 컴포넌트에서 선점                                                                                                   |
    | #                                       | 프래그먼트의 구획 문자로 선점                                                                                            |
    | ?                                       | 질의 문자열의 구획 문자로 선점                                                                                           |
    | ;                                       | 파라미터의 구획 문자로 선점                                                                                              |
    | :                                       | 스킴, 사용자 이름/비밀번호, 호스트/포트의 구획 문자로 선점                                                               |
    | `$`,`+`                                 | 선점                                                                                                                     |
    | `@`,`&`,`=`                             | 특정 스킴에서 특별한 의미가 있기 때문에 선점                                                                             |
    | `{}`,`세로선`,`\`,`가운데점`,`~`,`[]`,` | 게이트웨이와 같은 여러 전송 에이전트에서 불안전하게 다루기 때문에 제한됨                                                 |
    | `<>`,`"`                                | 안전하지 않음. 웹 문서에서 URL을 구분 지어 표시하듯이, URL 범위 밖에서 역할이 있는 문자이기 때문에 반드시 인코딩해야한다 |
- 좀 더 알아보기
  - 애플리케이션 개발자들이 안전하지 않은 문자를 인코딩하지 ㅇ낳는 것은 실수다.
  - 입력받은 URL에서 어떤 문자를 인코딩해야 하는지 결정하는 데는 브라우저와 같이 사용자로부터 최초로 URL을 입력받는 애플리케이션에서 하는 것이 가장 적절하다

### 2.5 스킴의 바다

- http
  - 사용자 이름이나 비밀번호가 없다는 것을 제외하고는, 일반 URL 포맷을 지키는 하이퍼텍스트 전송 프로토콜 스킴이다.
  - 포트값이 생략되어 있으면 기본값은 80이다.
- https
  - https스킴은 http 스킴과 거의 같다
  - 다른 점이라고는 https는 HTTP의 커넥션의 양 끝단에서 암호화하기 위해 넷스케이프에서 개발한 보안 소켓 계층(SSL)을 사용한다는 것이다
  - 문법은 HTTP와 같고 기본 포트값은 443이다
- maito
  - maito URL은 이메일 주소를 가리킨다.
  - 이메일은 다른 스킴과는 다르게 동작하기 때문에, maito URL은 표준 URL과 다른 포맷을 가진다.
  - 인터넷 이메일 주소의 문법은 RFC 822에 기술되어 있다
  - 기본형식
    - `maito: <RFC-822-addr-spec>`
    - 예시: `maito:joe@joes-hardware.com`
- ftp
  - 파일 전송 프로토콜 URL은 FTP 서버에 있는 파일을 내려 받거나 올린다
  - FTP 서버의 디렉터리에 있는 콘텐츠 목록을 가져오는 데 사용할 수 있다.
  - FTP는 웹과 URL이 출현하기 전부터 있었다
  - 웹 애플리케이션은 데이터에 접근하는 용도의 스킴으로 FTP를 사용한다. URL문법은 일반적인 문법이다
- rtsp, rtspu
  - RTSP URL은 실시간 스트리밍 프로토콜을 통해서 읽을 수 있는 오디오 및 비디오와 같은 미디어 리소스 식별자다
  - rtspu 스킴에 있는 `u`는 리소스를 읽기 위해서 UDP 프로토콜이 사용됩을 뜻한다
  - 기본형식
    - `rtsp://사용자이름:비밀번호@호스트:포트/경로`
    - 예시: `rtsp://www.joes-hardware.com:553/interview/cto_video`
- file
  - file 스킴은 주어진 호스트 기기에서 바로 접근할 수 있는 파일들ㅇ르 나타낸다
  - 각 필드도 일반적인 URL 포맷을 따른다
  - 만약 호스트가 생략되어 있으면, URL을 사용하고 있는 기기의 로컬 호스트가 기본값이 된다
- news
  - news 스킴은 RFC 1036에 정의된 바와 같이 특정 문서나 뉴스 그룹에 접근하는데 사용한다
  - news URL은 리소스의 위치 정보를 충분히 포함하지 않는 특이한 속성이 있다.
  - news URL은 해당 리소스가 어디에 있는지에 대한 정보를 포함하지 않는다
  - 호스트 명이나 서버 이름도 제공하지 않는다. 사용자로부터 그 정보를 알아내는 것은 애플리케이션의 몫이다.
  - 뉴스 리소스는 여러 서버를 통해 접근할 수 있다. 뉴스 리소스에 접근하는 것이 하나의 서버로만 접근할 수 있는 게 아니므로, 위치에 독립적이라고 할 수 있다.
- telnet
  - telnet 스킴은 대화형 서비스에 접근하는데 사용한다.
  - telnet URL 자체가 객체를 가리키지는 않지만, 리소스라고 할 수 있는 대화형 애플리케이션은 이 telnet 프로토콜을 통해 접근할 수 있다.

### 2.6 미래

URL은 강력한 도구다. 하지만 완벽하진 않다. 주소만 알려줄 뿐 실제 이름은 아니다. 그리하여 지금 URN 개념이 나오고 있는 것이다. URN은 객체가 옮겨지더라도 항상 객체를 가리킬 수 있는 이름을 제공한다
