# 2부 HTTP 아키텍처

## 5장 웹 서버

> - 여러 종류의 소프트웨어 및 하드웨어 웹 서버에 대해 조사한다
> - HTTP 통신을 진단해주는 간단한 웹 서버를 펄(Perl)로 작성해본다
> - 어떻게 웹 서버가 HTTP 트랜잭션을 처리하는지 단계별로 설명한다

### 5.1 다채로운 웹서버

1. 웹 서버 구현
   - 웹 서버는 HTTP 및 그와 관련된 TCP 처리를 구현한 것이다.
   - HTTP 프로토콜을 구현하고, 웹 리소스를 관리하고, 웹 서버 관리 기능을 제공한다
   - TCP 커넥션 관리에 대한 책임을 운영체제와 나눠 갖는다
   - 여러 형태가 있다
     - 다목적 소프트웨어 웹 서버를 표준 컴퓨터 시스템에 설치하고 실행할 수 있다.
     - 마이크로프로세서의 기적으로, 어떤 회사들은 사용자에게 판매할 전자기기 안에 몇 개의 컴퓨터 칩만으로 구현된 웹 서버를 내장시켜서 완전한 관리 콘솔로 제공한다
2. 다목적 소프트웨어 웹 서버 (조금 옛날 자료)
   - 모든 인터넷 웹 사이트의 37%가 마이크로 소프트 웹 서버를 통해 서비스 되고 있다
   - 아파치 웹 서버가 점유율 35%로, 최근 근소한 차이로 점유율 2위로 밀려났다
   - nginx 서버를 사용하는 사이트가 꾸준히 증가하고 있다
3. 임베디드 웹 서버
   - 임베디드 웹 서버는 일반 소비자용 제품에 내장될 목적으로 만들어진 작은 웹서버이다(프린터, 가전제품 등)

### 5.2 간단한 펄 웹 서버

걍 펄로 진짜 간단한 서버 돌리는 코드 나옴

### 5.3 진짜 웹 서버가 하는 일

1. 커넥션을 맺는다 - 클라이언트의 접속을 받아들이거나, 원치 않는 클라이언트라면 닫는다.
2. 요청을 받는다 - HTTP 요청 메시지를 네트워크로부터 읽어 들인다
3. 요청을 처리한다 - 요청 메시지를 해석하고 행동을 취한다
4. 리소스에 접근한다 - 메시지에서 지정한 리소스에 접근한다
5. 응답을 만든다 - 올바른 헤더를 포함한 HTTP 응답 메시지를 생성한다
6. 응답을 보낸다 - 응답을 클라이언트에게 돌려준다
7. 트랜잭션을 로그로 남긴다. - 로그파일에 트랜잭션 완료에 대한 기록을 남긴다

### 5.4 단계 1 클라이언트 커넥션 수락

> 클라이언트가 이미 서버에 대해 열려있는 지속적 커넥션을 갖고 있다면, 클라이언트는 요청을 보내기 위해 그 커넥션을 사용할 수 있다.

1. 새 커넥션 다루기
   - 클라이언트가 웹 서버에 TCP 커넥션을 요청하면, 웹 서버는 그 커넥션을 맺고 TCP 커넥션에서 IP 주소를 추출하여 커넥션 맞은편에 어떤 클라이언트가 있는지 확인한다.
   - 웹 서버는 어떤 커넥션이든 마음대로 거절하거나 즉시 닫을 수 있다.
2. 클라이언트 호스트 명 식별
   - 대부분의 웹 서버는 역방향 DNS를 사용해서 클라이언트의 IP 주소를 클라이언트의 호스트 명으로 변환하도록 설정되어 있다.
3. ident를 통해 클라이언트 사용자 알아내기
   - 몇몇 웹 서버는 또한 IETF ident 프로토콜을 지원한다
   - 클라이언트가 ident프로토콜을 지원한다면, 클라이언트는 ident 결과를 위해 TCP 포트 113번을 listen한다
   - 공공인터넷에서는 다양한 이유로 잘 동작하진 않는다
     - 많은 클라이언트 PC는 identd신원확인 프로토콜 데몬 소프트웨어를 실행하지 않는다
     - ident 프로토콜은 HTTP 트랜잭션을 유의미하게 지연시킨다
     - 방화벽이 ident 트래픽이 들어오는 것을 막는 경우가 많다
     - ident 프로토콜은 안전하지 ㅇ낳고 조작하기 쉽다
     - ident 프로토콜은 가상 ip주소를 잘 지원하지 않는다
     - 클라이언트 사용자 이름의 노출로 인한 프라이버시 침해의 우려가 있다.
