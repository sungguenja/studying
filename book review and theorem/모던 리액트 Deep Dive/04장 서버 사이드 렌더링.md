# 04장 서버 사이드 렌더링

> 1. 서버 사이드 렌더링이란?
> 2. 서버 사이드 렌더링을 위한 리액트 API 살펴보기
> 3. Next.js 톺아보기

## 1. 서버 사이드 렌더링이란?

> 서버 사이드 렌더링 코드를 작성하는 데는 싱글 페이지 애플리케이션을 만드는 것보다 신경 쓸 점이 훨씬 많다.
>
> 왜 서버 사이드 렌더링이 필요한지 배우지 못한다면 이러한 일련의 작업이 자칫 귀찮게만 느껴질 수 있다

1. 싱글 페이지 애플리케이션의 세상
   - SPA란 렌더링과 라우팅에 필요한 대부분의 기능을 서버가 아닌 자바스크립트에 의존하는 방식을 의미한다.
   - 한번 로딩된 이후에 리소스를 받아올 일이 적어지기 때문에 사용자에게 좋은 UI/UX를 제공한다
   - 기존 JS는 어디까지나 사용자에게 추가적인 경험을 주기 위한 보조적인 수단이었다
   - 그러나 다양한 기능을 하게 되며 `CommonJS`와 `AMD`가 등장하게 되었다.
   - 기술의 발전으로 용량이 커도 괜찮았지만
     - 점점 과하게 유저의 기기에 기대하는 것이 너무 커졌다
2. 서버 사이드 렌더링이란?
   - 페이지를 서버에서 렌더링하고 사용자에게 화면을 제공하는 방식
   - 장점
     - 최초 페이지 진입이 비교적 빠르다
     - 검색 엔진과 SNS 공유 등 메타데이터 제공이 쉽다
     - 누적 레이아웃 이동이 적다
     - 사용자의 디바이스 성능에 비교적 자유롭다
     - 보안에 좀 더 안전하다
   - 단점
     - 소스코드를 작성할 때 항상 서버를 고려해야 한다
     - 적절한 서버가 구축돼 있어야 한다
     - 서비스 지연에 따른 문제
3. SPA와 SSR을 모두 알아야 하는 이유
   - SSR 역시 만능이 아니다

## 2. 서버 사이드 렌더링을 위한 리액트 API 살펴보기

> 기본적으로 리액트는 프런트엔드 라이브러리로 브라우저 자바스크립트 환경에서 렌더링할 수 있는 방법을 제공하지만 이와 동시에 리액트 애플리케이션을 서버에서 렌더링할 수 있는 API도 제공한다
>
> 리액트 18이 릴리스되면서 `react-dom/server`에 `renderToPipeableStream`이 추가됐고, 나머지는 대부분 지원 중단되는 등 큰 변화를 거쳤다.

1. renderToString
   - renderToString은 이름에서도 알 수 있듯이 인수로 넘겨받은 리액트 컴포넌트를 렌더링해 HTML 문자열로 반환하는 함수다.
   - 서버 사이드 렌더링을 구현하는 데 가장 기초적인 API로, 최초의 페이지를 HTML로 먼저 렌덜이한다고 언급했는데 바로 그 역할을 하는 함수가 renderToString이다.
   - useEffect같은 훅과 handleClick과 같은 이벤트 핸들러는 결과물에 포함되지 않는다
     - 클라이언트에서 실행되는 JS 코드를 포함시키거나 렌더링하는 역할까지 해주지 않는다
   - 리액트의 서버 사이드 렌더링은 단순히 `최초 HTML 페이지를 빠르게 그려주는 데`에 목적이 있다
     - useEffect나 이벤트 헨들러가 없어서 실제로 사용자가 인터렉션할 준비가 되기 위해선 JS코드를 다운로드, 파싱, 실행하는 과정을 거쳐야 한다
   - div#root에 존재하는 data-reactroot를 주목해야한다
     - 이 속성은 리액트 컴포넌트의 루트 엘리먼트가 무엇인지 식별하는 역할이다
2. renderToStaticMarkup
   - renderToString과 유의미한 차이점은
     - 루트 요소에 추가한 data-reactroot와 같은 리액트에서만 사용하는 추가적인 DOM 속성을 만들지 않는다는 점이다
     - 리엑트에서만 사용하는 속성을 제거하면 결과물인 HTML의 크기를 아주 약간이라도 줄일 수 있다
   - 하지만 이 함수로 실행되면 useEffect나 브라우저 API를 절대로 실행할 수 없다
3. renderToNodeStream
   - renderToString과 결과물은 완전히 동일하지만 두가지 차이점이 있다
     1. renderToNodeStream은 브라우저에서 사용하는 것이 완전히 불가능하다
        - 앞선 두 API는 브라우저에서 사용 가능
        - renderToNodeStream은 완전히 Node.js 환경에 의존한다
     2. 결과물의 타입이 다르다
        - renderToString은 string인 문자열을 반환하지만
        - renderToNodeStream은 Nodes.js의 ReadableStream이다
   - readableStream 자체는 브라우저에서도 사용할 수 있는 객체다
     - 그러나 ReadableStream을 만드는 과정이 브라우저에서 불가능하게 구현돼 있다
   - renderToNodeStream은 작은 단위로 쪼개는게 가능해서 쓰일 수 있다
4. renderToStaticNodeStream
   - 순수 HTML 결과물이 필요할 때 쓰는 메서드
5. hydrate
   - renderToString과 renderToNodeStream으로 생성된 HTML콘텐츠에 JS핸들러나 이벤트를 붙이는 역할을 한다
   - render와 차이점은 hydrate는 기본적으로 이미 렌더링된 HTML이 있다는 가정하에 작업이 수행되고, 이 렌더링된 HTML을 기준으로 이벤트를 붙이는 작업만 실행한다는 것이다.
6. 서버 사이드 렌더링 예제 프로젝트
   - 그냥 Next.js쓰는게 좋긴 합니다
